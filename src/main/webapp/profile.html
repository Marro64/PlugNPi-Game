<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plug | Register</title>

  <!-- UT Favicon -->
  <link rel="icon" type="image/png" href="/images/ppicon.png" />

  <!-- DaisyUI tailwind component system and tailwind utility class framework -->
  <link href="https://cdn.jsdelivr.net/npm/daisyui@3.1.6/dist/full.css" rel="stylesheet" type="text/css" />
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Phone number input -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@18.1.1/build/css/intlTelInput.css">
  <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@18.1.1/build/js/intlTelInput.min.js"></script>

  <!-- API -->
  <script src="javascript/index.js" type="text/javascript"></script>

  <!-- Utils JS -->
  <script src="javascript/formHandler.js" type="text/javascript"></script>
  <script src="javascript/parser.js" type="text/javascript"></script>

  <!-- CSS -->
  <link rel="stylesheet" type="text/css" href="/styles/main.css" />

  <!-- Header custom component -->
  <script src="javascript/Navbar.js" type="text/javascript"></script>

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">

  <style>
    * {
      font-family: "Roboto", sans-serif !important;
    }
  </style>

  <script>
    /* Initializing state variables */

    var username;
    var email;
    var password;
    var newpassword;

    window.onload = () => {
      username = document.getElementById("username-input");
      email = document.getElementById("email-input");
      password = document.getElementById("password-input");
      newpassword = document.getElementById("confirm-password-input");

      /* Fetch profile information on load */
      (async () => {
        const profileDetailsCall = await APIGetProfileDetails();

        /* Setting details */
        document.getElementById("username-input").value = profileDetailsCall.username;
        document.getElementById("email-input").value = profileDetailsCall.email;
        document.getElementById("password-input").value = profileDetailsCall.password;
      })();
    }

    const validateForm = () => {
      /* Re-setting any displayed form errors */
      clearFormErrors();

      if(password.value !== newpassword.value){
        setFormError("Passwords do not match.", password);
        return false;
      }
      return true;
    }

    const getLog = async () => {
      document.getElementById("user-log").value = await APIGetUserLog();
    }

    const handleDetailsFormSubmit = async () => {
      if (!validateForm()) return;

      const data = {
        "email": email.value,
        "username": username.value,
        "password": password.value
      };

      await APIUpdateProfileDetailsCall(data);
    }
  </script>
</head>

<body>
<!-- Wrapper class for navbar and content -->
<div class="flex flex-col h-screen">
  <div id="buttons">
    <a class="mauricios-button hover:bg-pink-200" onclick="window.location.href='leaderboard.html';">Leaderboard</a>
    <a class="mauricios-button hover:bg-pink-300 float-right" onclick=APILogoutCall()>Log Out</a>
  </div>

  <!-- Page main content part -->
  <div class="flex w-full h-max grow flex-col bg-slate-200 gap-6 justify-center items-center p-8">


    <!-- Whole content wrapper -->
    <div class="w-1/3 flex flex-col gap-5 bg-white p-4 rounded-md shadow-sm">
      <h1 class="font-bold text-gray-700 text-2xl">Profile information</h1>
      <!-- Details section -->
      <div>
        <h1 class="text-gray-700">Details</h1>

        <div class="divider -mt-1"></div>

        <div class="-mt-4">

          <!-- First name -->
          <div class="form-group">
            <label class="label">
              <span class="label-text">Username</span>
            </label>

            <input type="text" id="username-input" value="mauricio_kicks_a$$" name="First name"
                   class="input w-full rounded-md bg-gray-100 transition-all duration-200 focus:border-gray-500 focus:bg-white disabled:bg-gray-100 disabled:border-none focus:ring-0 text-sm font-medium"
                   disabled />
          </div>

          <!-- Last name -->
          <div class="form-group">
            <label class="label">
              <span class="label-text">Email</span>
            </label>

            <input type="text" id="email-input" value="mauricio@kicksA$$.com" name="Last name"
                   class="input w-full rounded-md bg-gray-100 transition-all duration-200 focus:border-gray-500 focus:bg-white disabled:bg-gray-100 disabled:border-none focus:ring-0 text-sm font-medium"
                   disabled />
          </div>

          <!-- New Password -->
          <div class="form-group">
            <label class="label">
              <span class="label-text">New Password</span>
            </label>

            <input type="password" id="password-input" value="Tone" name="New Password" placeholder="********"
                   class="input w-full rounded-md bg-gray-100 transition-all duration-200 focus:border-gray-500 focus:bg-white disabled:bg-gray-100 disabled:border-none focus:ring-0 text-sm font-medium"
                   disabled />
          </div>

          <!-- Confirm new password -->
          <div class="form-group">
            <label class="label">
              <span class="label-text">Confirm New Password</span>
            </label>

            <input type="password" id="cofirm-password-input" value="Tone" name="Confirm new Password" placeholder="*********"
                   class="input w-full rounded-md bg-gray-100 transition-all duration-200 focus:border-gray-500 focus:bg-white disabled:bg-gray-100 disabled:border-none focus:ring-0 text-sm font-medium"
                   disabled />
          </div>

        </div>

        <div class="mt-4">
          <button
                  class="w-full text-white bg-blue-500 hover:bg-blue-600 focus:outline-none focus:ring-1 focus:ring-blue-700 font-medium rounded-md text-sm px-5 py-2.5 text-center transition-all duration-200"
                  onclick="handleDetailsFormSubmit()">Update</button>
        </div>
        <div class="mt-4">
          <button
                  class="w-full text-white bg-blue-500 hover:bg-blue-600 focus:outline-none focus:ring-1 focus:ring-blue-700 font-medium rounded-md text-sm px-5 py-2.5 text-center transition-all duration-200"
                  onclick="APIDeleteUser()">Delete Account</button>
        </div>
        <div class="mt-4">
          <button
                  class="w-full text-white bg-blue-500 hover:bg-blue-600 focus:outline-none focus:ring-1 focus:ring-blue-700 font-medium rounded-md text-sm px-5 py-2.5 text-center transition-all duration-200"
                  onclick="getLog()">Data Log</button>
        </div>

        <label for="user-log"></label><textarea class="w-full rounded-md bg-gray-100 transition-all duration-200 focus:border-gray-500 focus:bg-white disabled:bg-gray-100 disabled:border-none focus:ring-0 text-sm font-medium" id="user-log">User log area</textarea>
      </div>

      </div>
    </div>
  </div>
</body>

</html>